<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/userDetail.css">
    <link rel="stylesheet" type="text/css" href="/css/navbar.css">
    <title>마이페이지</title>
</head>
<body>
<h2>MyPage</h2>
<nav th:replace="~{fragments/navbar::nav}"></nav>

<table id="userTableBody">
    <tbody>
    <tr>
        <th>아이디</th>
        <td id="userId"></td> <!-- 아이디 표시 위치 -->
    </tr>
    <tr>
        <th>이름</th>
        <td id="userName"></td> <!-- 이름 표시 위치 -->
    </tr>
    <tr>
        <th>가입일</th>
        <td id="createdAt"></td> <!-- 가입일 표시 위치 -->
    </tr>
    </tbody>
</table>
<div class="button">
    <form action="/users/changePwd" method="get">
        <button type="submit">비밀번호 수정</button>
    </form>
    <form action="/users/deleteUser" method="get">
        <button type="submit">계정 삭제</button>
    </form>
    <form th:action="@{/boards/my-posts}" method="get">
        <button type="submit">내가 쓴 글</button>
    </form>
    <form th:action="@{/comments/my-comments}" method="get">
        <button type="submit">내가 쓴 댓글</button>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // 서버에서 사용자 정보를 가져와서 테이블에 추가하는 함수
        function loadMyPage() {
            $.ajax({
                type: 'GET',
                url: '/rest-api/users/myPage',
                success: function (response) {
                    // 서버에서 받아온 JSON 데이터를 이용하여 HTML을 생성하여 테이블에 추가합니다.
                    var user = response;
                    // 각 요소의 id를 사용하여 데이터를 채웁니다.
                    $('#userId').text(user.userId);
                    $('#userName').text(user.userName);
                    var createdAt = new Date(user.createdAt);
                    var formattedCreatedAt = ("0" + (createdAt.getFullYear() % 100)).slice(-2) + "-" + ("0" + (createdAt.getMonth() + 1)).slice(-2) + "-" + ("0" + createdAt.getDate()).slice(-2) + " " + ("0" + createdAt.getHours()).slice(-2) + ":" + ("0" + createdAt.getMinutes()).slice(-2);
                    $('#createdAt').text(formattedCreatedAt);
                },
                error: function (xhr, status, error) {
                    // 오류 발생 시 처리
                    console.error('Failed to load user info:', error);
                }
            });
        }
        // 페이지 로드 시 사용자 정보를 로드합니다.
        loadMyPage();
    });
</script>
</body>
</html>
