<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>마이페이지</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/userDetail.css">
    <link rel="stylesheet" type="text/css" href="/css/navbar.css">
    <style>
        /* Custom Styles */
        .my-page-container {
            padding: 20px;
        }

        .button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container my-page-container">
    <h2 class="text-center">MyPage</h2>
    <nav th:replace="~{fragments/navbar::nav}"></nav>

    <div class="table-responsive">
        <table class="table">
            <tbody>
            <tr>
                <th>아이디</th>
                <td id="userId"></td>
            </tr>
            <tr>
                <th>이름</th>
                <td id="userName"></td>
            </tr>
            <tr>
                <th>가입일</th>
                <td id="createdAt"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="button d-flex justify-content-center">
        <form action="/users/changePwd" method="get" class="mr-2">
            <button type="submit" class="btn btn-primary">비밀번호 수정</button>
        </form>
        <form action="/users/deleteUser" method="get" class="mr-2">
            <button type="submit" class="btn btn-danger">계정 삭제</button>
        </form>
        <form th:action="@{/boards/my-posts}" method="get" class="mr-2">
            <button type="submit" class="btn btn-success">내가 쓴 글</button>
        </form>
        <form th:action="@{/comments/my-comments}" method="get">
            <button type="submit" class="btn btn-info">내가 쓴 댓글</button>
        </form>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        // 서버에서 사용자 정보를 가져와서 테이블에 추가하는 함수
        function loadMyPage() {
            $.ajax({
                type: 'GET',
                url: '/rest-api/users/myPage',
                success: function (response) {
                    // 서버에서 받아온 JSON 데이터를 이용하여 HTML을 생성하여 테이블에 추가합니다.
                    var user = response;
                    // 각 요소의 id를 사용하여 데이터를 채웁니다.
                    $('#userId').text(user.userId);
                    $('#userName').text(user.userName);
                    var createdAt = new Date(user.createdAt);
                    var formattedCreatedAt = ("0" + (createdAt.getFullYear() % 100)).slice(-2) + "-" + ("0" + (createdAt.getMonth() + 1)).slice(-2) + "-" + ("0" + createdAt.getDate()).slice(-2) + " " + ("0" + createdAt.getHours()).slice(-2) + ":" + ("0" + createdAt.getMinutes()).slice(-2);
                    $('#createdAt').text(formattedCreatedAt);
                },
                error: function (xhr, status, error) {
                    // 오류 발생 시 처리
                    console.error('Failed to load user info:', error);
                }
            });
        }
        // 페이지 로드 시 사용자 정보를 로드합니다.
        loadMyPage();
    });
</script>
</body>
</html>
